openapi: 3.0.3
info:
  title: 电商会员系统API
  description: 电商会员系统基础功能RESTful API文档
  version: 1.0.0
  contact:
    name: 会员系统开发团队

servers:
  - url: https://api.example.com/v1
    description: 生产环境
  - url: https://api-staging.example.com/v1
    description: 测试环境

tags:
  - name: 注册
    description: 会员注册相关接口
  - name: 登录
    description: 会员登录相关接口
  - name: 会员信息
    description: 会员信息查询与修改
  - name: 收货地址
    description: 收货地址管理

paths:
  /member/register:
    post:
      tags:
        - 注册
      summary: 手机号注册
      description: 通过手机号+验证码+密码完成会员注册
      operationId: registerByPhone
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              phone: "13800138000"
              verificationCode: "123456"
              password: "Password123"
              agreePolicy: true
      responses:
        '200':
          description: 注册成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: 手机号已注册
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 409
                message: "该手机号已注册,可直接登录或找回密码"

  /member/register/third-party:
    post:
      tags:
        - 注册
      summary: 第三方账号注册
      description: 通过微信/支付宝/QQ授权完成会员注册
      operationId: registerByThirdParty
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ThirdPartyRegisterRequest'
            example:
              platformType: "WECHAT"
              authCode: "071abc1234567890"
              nickname: "张三"
              avatar: "https://example.com/avatar.jpg"
              agreePolicy: true
      responses:
        '200':
          description: 注册成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /member/login:
    post:
      tags:
        - 登录
      summary: 密码登录
      description: 通过手机号+密码完成登录
      operationId: loginByPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordLoginRequest'
            example:
              phone: "13800138000"
              password: "Password123"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: 密码错误或账号已锁定
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 401
                message: "密码错误,还有3次机会"
        '404':
          description: 手机号未注册
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /member/login/sms:
    post:
      tags:
        - 登录
      summary: 验证码登录
      description: 通过手机号+短信验证码完成免密登录
      operationId: loginBySms
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SmsLoginRequest'
            example:
              phone: "13800138000"
              verificationCode: "123456"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'

  /member/login/third-party:
    post:
      tags:
        - 登录
      summary: 第三方登录
      description: 通过微信/支付宝/QQ完成快捷登录
      operationId: loginByThirdParty
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ThirdPartyLoginRequest'
            example:
              platformType: "WECHAT"
              authCode: "071abc1234567890"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'

  /member/logout:
    post:
      tags:
        - 登录
      summary: 登出
      description: 会员登出,Token失效
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 登出成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /member/password/reset:
    post:
      tags:
        - 登录
      summary: 重置密码
      description: 通过短信验证码重置密码
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
            example:
              phone: "13800138000"
              verificationCode: "123456"
              newPassword: "NewPassword123"
      responses:
        '200':
          description: 重置成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /verification-code/send:
    post:
      tags:
        - 注册
      summary: 发送验证码
      description: 发送短信验证码(注册/登录/重置密码)
      operationId: sendVerificationCode
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendCodeRequest'
            example:
              phone: "13800138000"
              type: "REGISTER"
      responses:
        '200':
          description: 发送成功
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: integer
                    example: 200
                  message:
                    type: string
                    example: "验证码已发送"
                  expireTime:
                    type: integer
                    description: 过期时间(秒)
                    example: 300
        '429':
          description: 发送过于频繁
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: 429
                message: "操作过于频繁,请稍后再试"

  /member/info:
    get:
      tags:
        - 会员信息
      summary: 查询会员信息
      description: 查询当前登录会员的完整信息
      operationId: getMemberInfo
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberInfoResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

    put:
      tags:
        - 会员信息
      summary: 修改会员信息
      description: 修改会员基础信息(昵称、头像、性别、出生日期)
      operationId: updateMemberInfo
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateMemberRequest'
            example:
              nickname: "新昵称"
              avatar: "https://example.com/new-avatar.jpg"
              gender: 1
              birthday: "1990-01-01"
      responses:
        '200':
          description: 修改成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /member/login-history:
    get:
      tags:
        - 会员信息
      summary: 查询登录历史
      description: 查询最近10条登录记录
      operationId: getLoginHistory
      security:
        - BearerAuth: []
      parameters:
        - name: limit
          in: query
          description: 返回记录数量(默认10,最大50)
          schema:
            type: integer
            default: 10
            maximum: 50
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginHistoryResponse'

  /address:
    get:
      tags:
        - 收货地址
      summary: 查询收货地址列表
      description: 查询当前会员的所有收货地址
      operationId: getAddressList
      security:
        - BearerAuth: []
      responses:
        '200':
          description: 查询成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressListResponse'

    post:
      tags:
        - 收货地址
      summary: 添加收货地址
      description: 新增收货地址
      operationId: addAddress
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAddressRequest'
            example:
              receiverName: "张三"
              receiverPhone: "13800138000"
              provinceCode: "110000"
              provinceName: "北京市"
              cityCode: "110100"
              cityName: "北京市"
              districtCode: "110101"
              districtName: "东城区"
              detailAddress: "某某街道123号"
              postalCode: "100000"
              isDefault: false
      responses:
        '200':
          description: 添加成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddressResponse'

  /address/{addressId}:
    put:
      tags:
        - 收货地址
      summary: 修改收货地址
      description: 修改指定收货地址
      operationId: updateAddress
      security:
        - BearerAuth: []
      parameters:
        - name: addressId
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAddressRequest'
      responses:
        '200':
          description: 修改成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

    delete:
      tags:
        - 收货地址
      summary: 删除收货地址
      description: 删除指定收货地址
      operationId: deleteAddress
      security:
        - BearerAuth: []
      parameters:
        - name: addressId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 删除成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /address/{addressId}/default:
    put:
      tags:
        - 收货地址
      summary: 设置默认地址
      description: 将指定地址设为默认地址
      operationId: setDefaultAddress
      security:
        - BearerAuth: []
      parameters:
        - name: addressId
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 设置成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    RegisterRequest:
      type: object
      required:
        - phone
        - verificationCode
        - password
        - agreePolicy
      properties:
        phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
          description: 手机号
          example: "13800138000"
        verificationCode:
          type: string
          pattern: '^\d{6}$'
          description: 6位验证码
          example: "123456"
        password:
          type: string
          minLength: 8
          maxLength: 20
          description: 密码(8-20位,包含字母+数字)
          example: "Password123"
        agreePolicy:
          type: boolean
          description: 是否同意用户协议和隐私政策

    RegisterResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: "注册成功"
        data:
          type: object
          properties:
            memberId:
              type: integer
              example: 123456
            token:
              type: string
              description: JWT Token
              example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
            expiresIn:
              type: integer
              description: Token过期时间(秒)
              example: 604800

    ThirdPartyRegisterRequest:
      type: object
      required:
        - platformType
        - authCode
        - agreePolicy
      properties:
        platformType:
          type: string
          enum: [WECHAT, ALIPAY, QQ]
          description: 第三方平台类型
        authCode:
          type: string
          description: 授权码
        nickname:
          type: string
          description: 第三方昵称
        avatar:
          type: string
          description: 第三方头像URL
        agreePolicy:
          type: boolean

    PasswordLoginRequest:
      type: object
      required:
        - phone
        - password
      properties:
        phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        password:
          type: string

    SmsLoginRequest:
      type: object
      required:
        - phone
        - verificationCode
      properties:
        phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        verificationCode:
          type: string
          pattern: '^\d{6}$'

    ThirdPartyLoginRequest:
      type: object
      required:
        - platformType
        - authCode
      properties:
        platformType:
          type: string
          enum: [WECHAT, ALIPAY, QQ]
        authCode:
          type: string

    LoginResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: "登录成功"
        data:
          type: object
          properties:
            memberId:
              type: integer
            token:
              type: string
            expiresIn:
              type: integer
            needSecondVerify:
              type: boolean
              description: 是否需要二次验证(异地登录)
            defaultAddress:
              $ref: '#/components/schemas/Address'

    ResetPasswordRequest:
      type: object
      required:
        - phone
        - verificationCode
        - newPassword
      properties:
        phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        verificationCode:
          type: string
          pattern: '^\d{6}$'
        newPassword:
          type: string
          minLength: 8
          maxLength: 20

    SendCodeRequest:
      type: object
      required:
        - phone
        - type
      properties:
        phone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        type:
          type: string
          enum: [REGISTER, LOGIN, RESET_PASSWORD]
          description: 验证码类型

    MemberInfoResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: "查询成功"
        data:
          type: object
          properties:
            memberId:
              type: integer
            phone:
              type: string
              example: "138****1234"
            nickname:
              type: string
            avatar:
              type: string
            gender:
              type: integer
              enum: [0, 1, 2]
              description: 0:未知,1:男,2:女
            birthday:
              type: string
              format: date
            registerType:
              type: string
              enum: [PHONE, WECHAT, ALIPAY, QQ]
            registerTime:
              type: string
              format: date-time
            accountStatus:
              type: integer
              enum: [1, 2, 3, 4]
              description: 1:正常,2:冻结,3:未激活,4:已注销
            thirdPartyBindings:
              type: array
              items:
                type: object
                properties:
                  platformType:
                    type: string
                  bindTime:
                    type: string
                    format: date-time

    UpdateMemberRequest:
      type: object
      properties:
        nickname:
          type: string
          minLength: 2
          maxLength: 50
        avatar:
          type: string
          format: uri
        gender:
          type: integer
          enum: [0, 1, 2]
        birthday:
          type: string
          format: date

    LoginHistoryResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        data:
          type: array
          items:
            type: object
            properties:
              loginTime:
                type: string
                format: date-time
              loginIp:
                type: string
              ipRegion:
                type: string
              deviceType:
                type: string
                enum: [iOS, Android, PC]
              loginStatus:
                type: integer
                enum: [1, 2]

    Address:
      type: object
      properties:
        addressId:
          type: integer
        receiverName:
          type: string
        receiverPhone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        provinceCode:
          type: string
        provinceName:
          type: string
        cityCode:
          type: string
        cityName:
          type: string
        districtCode:
          type: string
        districtName:
          type: string
        detailAddress:
          type: string
        postalCode:
          type: string
        isDefault:
          type: boolean

    AddressListResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        data:
          type: array
          items:
            $ref: '#/components/schemas/Address'

    AddAddressRequest:
      type: object
      required:
        - receiverName
        - receiverPhone
        - provinceCode
        - provinceName
        - cityCode
        - cityName
        - districtCode
        - districtName
        - detailAddress
      properties:
        receiverName:
          type: string
          minLength: 1
          maxLength: 50
        receiverPhone:
          type: string
          pattern: '^1[3-9]\d{9}$'
        provinceCode:
          type: string
        provinceName:
          type: string
        cityCode:
          type: string
        cityName:
          type: string
        districtCode:
          type: string
        districtName:
          type: string
        detailAddress:
          type: string
          minLength: 1
          maxLength: 255
        postalCode:
          type: string
          pattern: '^\d{6}$'
        isDefault:
          type: boolean

    UpdateAddressRequest:
      type: object
      properties:
        receiverName:
          type: string
        receiverPhone:
          type: string
        detailAddress:
          type: string
        postalCode:
          type: string
        isDefault:
          type: boolean

    AddressResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        data:
          $ref: '#/components/schemas/Address'

    SuccessResponse:
      type: object
      properties:
        code:
          type: integer
          example: 200
        message:
          type: string
          example: "操作成功"

    ErrorResponse:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

  responses:
    BadRequest:
      description: 请求参数错误
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 400
            message: "请求参数错误"
            errors:
              - field: "phone"
                message: "手机号格式不正确"

    Unauthorized:
      description: 未授权或Token已过期
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: 401
            message: "Token已过期,请重新登录"
