# Feature Specification: 电商会员系统基础功能

**Feature Branch**: `feature/user-requirements`
**Created**: 2026-01-14
**Status**: Draft
**Input**: User description: "根据电商会员系统基础功能需求方案_一期.md生成spec"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 会员注册 (Priority: P0)

新用户通过手机号或第三方账号(微信/支付宝/QQ)完成注册,成为平台会员,并能立即使用会员功能。

**Why this priority**: 注册是会员系统的核心入口功能,没有注册就没有会员,P0优先级确保系统能够获取和沉淀用户。

**Independent Test**: 可通过以下方式独立测试:
- 完整注册流程(手机号+验证码+密码)
- 第三方授权注册流程
- 注册后自动登录并跳转首页
- 验证注册校验规则(手机号格式、验证码有效性、密码强度)

**Acceptance Scenarios**:

1. **Given** 用户未注册, **When** 输入有效手机号并获取验证码, **Then** 系统发送6位数字验证码,有效期5分钟
2. **Given** 用户收到验证码, **When** 输入正确验证码并设置符合规则的密码, **Then** 注册成功并自动登录
3. **Given** 手机号已注册, **When** 尝试再次注册, **Then** 提示"该手机号已注册,可直接登录或找回密码"
4. **Given** 用户选择第三方注册, **When** 完成授权并勾选协议, **Then** 自动创建账号并登录
5. **Given** 验证码1分钟内获取超过1次, **When** 再次请求获取, **Then** 提示"操作过于频繁,请稍后再试"
6. **Given** 密码不符合规则(如长度<8位), **When** 输入密码, **Then** 实时提示密码强度并阻止提交

---

### User Story 2 - 会员登录 (Priority: P0)

已注册会员通过手机号+密码、手机号+验证码或第三方账号完成登录,访问个人中心等功能。

**Why this priority**: 登录是会员使用系统功能的前提,P0优先级确保会员能够正常访问和使用平台服务。

**Independent Test**: 可通过以下方式独立测试:
- 手机号+密码登录流程
- 手机号+验证码免密登录流程
- 第三方快捷登录流程
- 登录失败异常处理(密码错误、账号锁定、异地登录验证)

**Acceptance Scenarios**:

1. **Given** 账号密码正确, **When** 提交登录, **Then** 登录成功并跳转至首页
2. **Given** 密码错误, **When** 连续5次输入错误密码, **Then** 账号临时锁定15分钟并提示
3. **Given** 用户忘记密码, **When** 点击"忘记密码"并完成验证, **Then** 可重置新密码并登录
4. **Given** 检测到异地登录, **When** 触发二次验证, **Then** 需输入短信验证码方可登录
5. **Given** 第三方账号已绑定, **When** 选择第三方登录, **Then** 授权后直接登录成功
6. **Given** 手机号未注册, **When** 尝试登录, **Then** 提示"该手机号未注册,请先注册"

---

### User Story 3 - 会员信息查询 (Priority: P1)

会员登录后查看和管理个人基础信息、账号安全信息、收货地址等信息。

**Why this priority**: 信息查询是会员管理个人资料的基础功能,P1优先级确保会员能够查看和管理自己的信息。

**Independent Test**: 可通过以下方式独立测试:
- 查询基础信息(会员ID、昵称、头像、性别等)
- 查询账号安全信息(绑定手机号、第三方账号、登录记录)
- 查询收货地址列表
- 导出个人信息为Excel

**Acceptance Scenarios**:

1. **Given** 会员已登录, **When** 进入"我的信息"页面, **Then** 显示完整的基础信息、账号安全信息、收货地址
2. **Given** 会员查看信息, **When** 页面加载, **Then** 按类别分区展示,结构清晰
3. **Given** 会员导出信息, **When** 点击"导出"按钮, **Then** 下载包含所有个人信息的Excel文件
4. **Given** 会员查看登录记录, **When** 进入"安全信息"区域, **Then** 显示近10条登录记录(时间、设备、IP地域)
5. **Given** 会员更换头像, **When** 上传新头像, **Then** 查询页面即时刷新显示新头像

---

### User Story 4 - 会员信息修改 (Priority: P1)

会员修改个人基础信息(昵称、头像、性别、出生日期)和收货地址。

**Why this priority**: 信息修改是会员管理个人资料的核心功能,P1优先级确保会员能够更新个人信息。

**Independent Test**: 可通过以下方式独立测试:
- 修改昵称、头像、性别、出生日期
- 添加、编辑、删除收货地址
- 设置默认收货地址
- 修改信息后查询页面实时同步

**Acceptance Scenarios**:

1. **Given** 会员已登录, **When** 修改昵称并保存, **Then** 修改成功并提示"昵称修改成功"
2. **Given** 会员上传新头像, **When** 选择图片并上传, **Then** 头像更新成功
3. **Given** 会员添加收货地址, **When** 填写完整地址信息并保存, **Then** 地址添加成功并显示在列表中
4. **Given** 会员有多个收货地址, **When** 设置某个地址为默认, **Then** 该地址标记为默认地址
5. **Given** 会员删除地址, **When** 点击删除并确认, **Then** 地址从列表中移除

---

### User Story 5 - 账号注销 (Priority: P2)

会员主动申请注销账号,系统按合规要求处理注销请求。

**Why this priority**: 账号注销是法规要求的合规功能,P2优先级确保平台符合《个人信息保护法》要求。

**Independent Test**: 可通过以下方式独立测试:
- 提交注销申请
- 注销确认(二次确认)
- 注销后账号状态变更
- 注销后无法登录

**Acceptance Scenarios**:

1. **Given** 会员已登录, **When** 申请注销账号并确认, **Then** 账号状态变更为"已注销"
2. **Given** 账号已注销, **When** 尝试登录, **Then** 提示"账号已注销"并拒绝登录
3. **Given** 会员提交注销申请, **When** 未确认, **Then** 账号保持正常状态
4. **Given** 账号有未完成订单, **When** 申请注销, **Then** 提示"请先完成或取消未完成订单"

---

### Edge Cases

- **验证码场景**: 验证码过期后重新获取、验证码输错后的提示、验证码防刷限制
- **密码场景**: 密码重置后原登录状态失效、新密码与历史密码重复校验
- **第三方登录场景**: 第三方账号解绑后无法登录、第三方授权失败的处理
- **异地登录场景**: 异地登录触发二次验证、验证失败后的处理
- **并发场景**: 同一账号多设备登录、同一时间多次修改信息;同一手机号多端同时注册时,通过数据库唯一索引约束保证一致性,后提交的请求返回"手机号已注册"提示
- **网络异常场景**: 请求超时、网络中断时的提示和状态保持
- **数据一致性场景**: 注册后立即查询信息、修改信息后多端同步
- **短信服务故障场景**: 短信服务超时或失败时,自动切换为图形验证码+弱密码策略,并在界面提示"短信服务暂时不可用,请使用图形验证码注册/登录"

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持手机号注册(11位数字,以13/14/15/17/18/19开头)
- **FR-002**: 系统必须支持手机号+短信验证码(6位数字,有效期5分钟)注册流程
- **FR-003**: 系统必须支持密码校验(长度8-20位,包含字母+数字,支持特殊字符)
- **FR-004**: 系统必须在注册时要求用户勾选《用户服务协议》《隐私政策》
- **FR-005**: 系统必须支持第三方账号注册(微信、支付宝、QQ),获取用户昵称和头像
- **FR-006**: 系统必须支持手机号+密码登录和手机号+验证码免密登录
- **FR-007**: 系统必须支持第三方快捷登录(微信、支付宝、QQ)
- **FR-008**: 系统必须在连续5次密码错误后锁定账号15分钟
- **FR-009**: 系统必须检测异地登录并触发二次验证(短信验证码)
- **FR-010**: 系统必须记录登录失败日志(时间、IP、设备)
- **FR-011**: 系统必须支持忘记密码功能,通过短信验证码重置密码
- **FR-012**: 系统必须校验新密码不可与近3次使用过的密码重复
- **FR-013**: 系统必须支持会员查询基础信息(会员ID、昵称、头像、性别、出生日期、注册时间、注册方式)
- **FR-014**: 系统必须支持会员查询账号安全信息(绑定手机号、第三方账号、账号状态)
- **FR-015**: 系统必须支持会员查询最近10条登录记录(时间、设备、IP地域)
- **FR-016**: 系统必须支持会员查询和修改收货地址(收货人、手机号、地址、邮编)
- **FR-017**: 系统必须支持会员导出个人信息为Excel格式
- **FR-018**: 系统必须支持会员修改基础信息(昵称、头像、性别、出生日期)
- **FR-019**: 系统必须支持会员添加、编辑、删除收货地址
- **FR-020**: 系统必须支持会员设置默认收货地址
- **FR-021**: 系统必须支持账号注销功能(需二次确认)
- **FR-022**: 系统必须在账号有未完成订单时阻止注销
- **FR-023**: 系统必须在注册后自动登录并跳转首页
- **FR-024**: 系统必须在注册完成后弹出引导弹窗,提示完善个人资料
- **FR-025**: 系统必须限制头像上传文件大小≤2MB,仅支持JPG/PNG格式
- **FR-026**: 系统必须在短信服务故障时降级为图形验证码+弱密码策略(密码长度6-20位即可)
- **FR-027**: 系统必须以INFO级别记录关键操作(注册、登录、信息修改),以ERROR级别记录所有失败操作

### Key Entities

- **会员(Member)**: 平台注册用户,包含会员ID、手机号、密码、昵称、头像、性别、出生日期、注册时间、注册方式、账号状态、第三方绑定信息
- **验证码(VerificationCode)**: 短信验证码,包含手机号、验证码、类型(注册/登录/重置密码)、过期时间、发送次数
- **登录记录(LoginLog)**: 会员登录历史,包含会员ID、登录时间、登录IP、IP地域、登录设备、登录状态
- **收货地址(Address)**: 会员收货地址,包含地址ID、会员ID、收货人、手机号、省市区、详细地址、邮编、是否默认
- **第三方绑定(ThirdPartyBinding)**: 第三方账号绑定关系,包含绑定ID、会员ID、平台类型(微信/支付宝/QQ)、第三方OpenID、绑定时间

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 注册成功率≥98%,排除用户主动放弃和手机号格式错误的情况
- **SC-002**: 登录成功率≥95%,排除用户密码遗忘和账号锁定的情况
- **SC-003**: 注册、登录请求响应时间≤1秒(95分位)
- **SC-004**: 信息查询、修改响应时间≤500ms(95分位)
- **SC-005**: 支持10000人同时注册/登录,系统无卡顿、超时
- **SC-006**: 支持5000人同时查询/修改信息,系统稳定运行
- **SC-007**: 会员密码加密存储,采用BCrypt加密
- **SC-008**: 手机号、收货地址等敏感信息传输采用HTTPS加密
- **SC-009**: 敏感信息存储时脱敏处理(如手机号显示为138****1234)
- **SC-010**: 会员注册、登录、信息修改、密码重置等操作日志永久留存
- **SC-011**: 核心流程(注册、登录、信息查询)操作步骤≤3步
- **SC-012**: 注册流程完整率≥90%(用户完成注册流程的比例)
- **SC-013**: 会员信息查询页面加载时间≤2秒(PC端)、≤1.5秒(移动端)
- **SC-014**: 第三方注册/登录成功率≥98%
- **SC-015**: 验证码发送成功率≥99%,发送延迟≤3秒

## Clarifications

### Session 2026-01-14

- Q: 密码加密方案 → A: BCrypt
- Q: 头像上传约束 → A: 文件大小≤2MB,支持JPG/PNG格式
- Q: 短信服务故障降级策略 → A: 降级为图形验证码+弱密码策略
- Q: 并发注册冲突处理 → A: 数据库唯一索引约束,返回"手机号已注册"提示
- Q: 日志记录详细程度 → A: INFO级别记录关键操作(注册/登录/信息修改)+ERROR级别记录失败
